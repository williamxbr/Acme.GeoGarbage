<div class="row-fluid" style="padding: 10px">
    <div class="container-fluid">
        <ul class="nav nav-pills">
            <li class="active">
                <a href="#TabConstrutorTabelas" data-toggle="tab"><b>TABELAS</b></a>
            </li>
            <li>
                <a href="#TabConstrutorCampos" data-toggle="tab"><b>CAMPOS</b></a>
            </li>
            <li>
                <a href="#TabConstrutorFuncoes" data-toggle="tab"><b>FUNÇÕES</b></a>
            </li>
            <li>
                <a href="#TabConstrutorGrupos" data-toggle="tab"><b>GRUPOS</b></a>
            </li>
            <li>
                <a href="#TabConstrutorFiltros" data-toggle="tab"><b>FILTROS</b></a>
            </li>
            <li>
                <a href="#TabConstrutorCalculos" data-toggle="tab"><b>CALCULOS</b></a>
            </li>
            <li>
                <a href="#TabConstrutorPosicao" data-toggle="tab"><b>POSIÇÃO</b></a>
            </li>
            <li>
                <a href="#TabConstrutorPreview" data-toggle="tab"><b>PREVIEW</b></a>
            </li>
            <li>
                <a href="#TabConstrutorArquivamento" data-toggle="tab"><b>ARQUIVAMENTO</b></a>
            </li>
        </ul>
        <hr />
        <div class="tab-content clearfix">
            <div class="tab-pane active" id="TabConstrutorTabelas" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <div class="checkbox" style="display: inline;float: right">
                        <input type="checkbox" id="ckDistinct" />Distinto
                    </div>
                    <div class="panel-heading">
                        Tabelas Disponiveis
                    </div>
                    <div class="panel-body">
                        <table id="tabelasdisponiveis" class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Tabela</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Tabelas Selecionadas</div>
                    <div class="panel-body">
                        <ul id="tabelasselecionadas"></ul>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Relacionamentos</div>
                    <div class="panel-body">
                        <ul id="listaRelacionamento"></ul>
                    </div>
                </div>


            </div>
            <div class="tab-pane" id="TabConstrutorCampos" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <div class="panel-heading">Campos Disponiveis</div>
                    <div class="panel-body">
                        <table id="camposdisponiveis" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campo no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Tabelas Selecionadas</div>
                    <div class="panel-body">
                        <table id="camposselecionados" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campo no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="TabConstrutorFuncoes" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <div class="panel-heading">Campos Disponiveis</div>
                    <div class="panel-body">
                        <table id="camposdisponiveis_funcoes" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campo no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Tabelas Selecionadas</div>
                    <div class="panel-body">
                        <table id="camposselecionados_funcoes" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campo no SQL</th>
                                    <th>Tabela</th>
                                    <th>Função</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="TabConstrutorGrupos" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <div class="panel-heading">Campos Disponiveis</div>
                    <div class="panel-body">
                        <table id="camposdisponiveis_grupo" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campo no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Tabelas Selecionadas</div>
                    <div class="panel-body">
                        <table id="camposselecionados_grupo" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campo no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="TabConstrutorFiltros" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <div class="panel-heading">Campos Disponiveis</div>
                    <div class="panel-body">
                        <table id="camposdisponiveis_filtro" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campos no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Tabelas Selecionadas</div>
                    <div class="panel-body">
                        <table id="camposselecionados_filtro" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Campo</th>
                                    <th>Operador</th>
                                    <th>Valor</th>
                                    <th>Ação</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

            </div>
            <div class="tab-pane" id="TabConstrutorCalculos">
                <div class="panel panel-default">
                    <div class="panel-heading">Campos Disponiveis</div>
                    <div class="panel-body">
                        <div class="row-fluid">
                            <div class="col-md-4">
                                <table id="camposdisponiveis_calculo" class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>Campos</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="col-md-4">
                                <div>
                                    <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-primary"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-success"><span class="glyphicon glyphicon-asterisk" aria-hidden="true"></span></button>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-info"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-warning"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-danger"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </div>
                            </div>
                            <div class="col-md-4"></div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Tabelas Selecionadas</div>
                    <div class="panel-body">
                        <table id="camposselecionados_calculo" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido</th>
                                    <th>Expressão</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="TabConstrutorPosicao" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <div class="panel-heading">Campos Disponiveis</div>
                    <div class="panel-body">
                        <table id="camposdisponiveis_posicao" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campos no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Tabelas Selecionadas</div>
                    <div class="panel-body">
                        <table id="camposselecionados_posicao" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Apelido do Campo</th>
                                    <th>Campo no SQL</th>
                                    <th>Tabela</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="TabConstrutorPreview" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <div class="panel-heading">Query</div>
                    <div class="panel-body">
                        <form id="executesql-form">
                            <textarea class="form-control" rows="7" cols="10" id="text_sql"></textarea>
                            <button type="submit" class="btn btn-success">Executar</button>
                        </form>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Resultado</div>
                    <div class="panel-body">
                        <div id="result"></div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="TabConstrutorArquivamento" style="padding-bottom: 2%">
                <div class="panel panel-default">
                    <form id="saveQuery-form" onsubmit="validasaveQueryform();">
                        <div class="panel panel-default">
                            <div class="panel-heading">Escolha uma pasta</div>
                            <div class="panel-body">
                                <ul id="listaPastas" class="list-group"></ul>
                            </div>
                        </div>
                        <label for="nomeconsulta">Nome da consulta</label>
                        <input type="text" class="form-control" id="nomeconsulta" required>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModalCreateFolder">Criar Pasta</button>
                        <button type="submit" class="btn btn-success">Salvar consulta</button>
                        <button type="reset" class="btn btn-danger">Cancelar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="myModalCreateFolder" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Criar Pasta</h4>
            </div>
            <form id="createfolder-form" method="post">
                <div class="modal-body">
                    <input type="text" id="folder" class="form-control" />
                    <p id="msg"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>


@Scripts.Render("~/bundles/jquery")
<script>
    var tabelas = new Array();
    var campos = new Array();
    var funcoes = new Array();
    var filtros = new Array();
    var posicoes = new Array();

    var condicoes = new Array();
    var groupby = new Array();
    var orderby = new Array();

    var lista = [];

    var pasta = "";

    function alteraCorlistaPasta(id) {
        var listali = $("#listaPastas li");

        for (index = 0; index <= listali.length; ++index) {
            var linha = listali[index].id;
            if (linha == id) {
                var listitemactiva = document.getElementById(id);
                listitemactiva.style.backgroundColor = "#dddddd";
                pasta = id;
            } else {
                var listiteminativa = document.getElementById(linha);
                listiteminativa.style.backgroundColor = "#ffffff";
            }

        }
    }


    $('#saveQuery-form')
        .on('submit', function (e) {
            e.preventDefault();
            var nomeconsulta = this.nomeconsulta.value;
            $.ajax({
                url: '/Relatorio/Consulta/CriarConsultaDinamica',
                type: 'POST',
                data: { pasta: pasta, nomeconsulta: nomeconsulta, postTabelas: tabelas, postCampos: campos, postFuncoes: funcoes },
                success: function (msg) {
                    alert(msg);
                },
                failure: function (msg) {
                    alert(msg);
                }
            });
        });


    $(function () {
        $('#createfolder-form').on('submit', function (e) {
            var folder = $('#folder').val();
            e.preventDefault();
            $.ajax({
                url: '/Relatorio/Consulta/CriarPasta',
                type: 'POST',
                data: { pasta: folder },
                success: function (msg) {
                    getPastas();
                    $('#msg').html(msg);
                }
            });
        });
    });


    //var gridx = new FancyGrid({
    //    title: 'Resultado',
    //    renderTo: 'container',
    //    width: 500,
    //    height: 400,
    //    data: { proxy: { url: '/Relatorio/Consulta/Resultado'} },
    //    defaults: {
    //        type: 'string',
    //        width: 100,
    //        sortable: true,
    //        filter: {
    //            header: true,
    //            emptyText : 'Procura'
    //        }
    //    },
    //    columns: [{ index: 'Status', width: 100, type: 'number', title: 'Status' }]
    //});

    $('#executesql-form')
        .on('submit', function (e) {
            e.preventDefault();
            var SQL = this.text_sql.value;
            var grid = $('#result');

            var tabela = $('<table/>');
            tabela.addClass('table table-bordered');
            tabela.attr('id', 'preview');

            grid.html(tabela);

            var cabecalho = $('<thead/>');
            tabela.append(cabecalho);

            var linhacabecalho = $('<tr/>');
            cabecalho.append(linhacabecalho);

            for (var ind = 0; ind < campos.length; ++ind) {
                var field = $('<th/>');
                field.append($("#campoiddest" + campos[ind]).find("td").eq(0).html());
                linhacabecalho.append(field);
            }

            var corpo = $('<tbody/>');
            tabela.append(corpo);

            $.ajax({
                url: '/Relatorio/Consulta/Resultado',
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                traditional: true,
                data: {camposid : campos, SQL: SQL },
                dataType: "json",
                success: function (response) {
                    $.each(response, function (index, item) {
                        var linha = $('<tr/>');
                        $.each(item, function (index, field) {
                            var coluna = $('<td/>');
                            coluna.append(field);
                            linha.append(coluna);
                        });
                        corpo.append(linha);
                    });
                },
                fail: function (msn) {
                    console.log(msn);
                }
            });

        });

    function getPastas() {
        var url = "/Relatorio/Consulta/ListaPastas";
        var listaPastas = $("#listaPastas");
        $.getJSON(url, "", function (response) {
            listaPastas.empty();
            $.each(response, function (index, item) {
                var li = $('<li/>');
                li.attr('id', item.IdConsultaPasta);
                li.addClass('list-group-item');
                li.attr('onmousedown', 'alteraCorlistaPasta(this.id)');
                li.append(item.NomePasta);
                listaPastas.append(li);
            });
        });
    }

    function getTabelas() {
        $.ajax({
            url: "/Relatorio/Construtor/BuscaTabelas",
            type: "GET",
            contentType: "application/json; charset=utf-8",
            data: "{}",
            dataType: "json",
            success: function (data) {
                var row = "";
                $.each(data,
                    function (index, item) {
                        row += "<tr><td>" + item.Nome + "</td>";
                        row += "<td><button id='tabelaid" + item.IdConstrutorTabela + "' type='button' class='botaotd'><span class='glyphicon glyphicon-plus' aria-hidden='true'></span></button>";
                        row += "</td></tr>";
                    });
                $("#tabelasdisponiveis tbody").html(row);
            },
            error: function (result) {
                alert("Error");
            }
        });
    }

    function getCampos() {

        if (tabelas.length == 0) {
            limpaCampos();
        } else {
            $.ajax({
                url: "/Relatorio/Construtor/BuscaCampos",
                type: "GET",
                contentType: "application/json; charset=utf-8",
                traditional: true,
                data: { tabelas: tabelas },
                dataType: "json",
                success: function (data) {
                    var row = "";
                    var rowCalculo = "";
                    $.each(data,
                        function (index, item) {
                            row += "<tr><td>" +
                                item.Nome +
                                "</td><td>" +
                                item.ConstrutorTabela.Nome +
                                "." +
                                item.Nome +
                                "</td><td>" +
                                item.ConstrutorTabela.Nome +
                                "</td><td>";
                            row += "<button  id='campoid" +
                                item.IdConstrutorCampo +
                                "' type='button' class='botaotd'><span class='glyphicon glyphicon-plus' aria-hidden='true'></span></button></td></tr>";
                            rowCalculo += "<tr id='campocalculosid" + item.IdConstrutorCampo + "'><td>" + item.ConstrutorTabela.Nome + "." + item.Nome + "</td></tr>";
                        });

                    $("#camposdisponiveis tbody").html(row);
                    var rowBody = row.replace(/campoid/g, "campofuncoesid");
                    $("#camposdisponiveis_funcoes tbody").html(rowBody);
                    var rowGrupo = row.replace(/campoid/g, "campogruposid");
                    $("#camposdisponiveis_grupo tbody").html(rowGrupo);
                    var rowFiltro = row.replace(/campoid/g, "campofiltrosid");
                    $("#camposdisponiveis_filtro tbody").html(rowFiltro);
                    //var rowCalculo = row.replace(/campoid/g, "campocalculosid");
                    $("#camposdisponiveis_calculo tbody").html(rowCalculo);
                    var rowPosicao = row.replace(/campoid/g, "campoposicaoid");
                    $("#camposdisponiveis_posicao tbody").html(rowPosicao);

                    getRelacionamentos();
                    checaCamposSelecionados();

                },
                error: function (result) {
                    alert("Problemas no carregamentos dos campos");
                }
            });
        }
    }

    function getRelacionamentos() {
        $.ajax({
            url: "/Relatorio/Construtor/BuscaRelacionamentos",
            type: "GET",
            contentType: "application/json; charset=utf-8",
            traditional: true,
            data: { tabelas: tabelas },
            dataType: "json",
            success: function (data) {
                var linha = "";
                $.each(data,
                    function (index, item) {
                        linha += '<li id="liRelat"' +
                            item.IdConstrutorChaveEstrangeira +
                            '">' +
                            item.ConstrutorTabela.Nome +
                            '.' +
                            item.ConstrutorCampo.Nome +
                            '=' +
                            item.ConstrutorTabelaMestre.Nome +
                            '.' +
                            item.ConstrutorCampoMestre.Nome +
                            '</li>';

                    });

                $('#listaRelacionamento').html(linha);
            },
            error: function (result) {
                alert("Problemas no carregamentos dos relacionementos");
            }
        }
        );
    }

    function getFuncao(select) {
        var trid = select.parentNode.parentNode.id.replace("campofuncoesiddest", "");
        select.parentNode.innerText = select.value;
        funcoes[funcoes.indexOf(trid)] += "&" + select.value;
        montaConsulta();
    }

    function getFiltro(objeto, id) {
        var seletor = $("#select_operador_" + id)[0].parentNode;
        seletor.innerText = $("#select_operador_" + id)[0].value;
        var inputvalor = $("#input_valor_" + id)[0].parentNode;
        inputvalor.innerText = $("#input_valor_" + id)[0].value;
        var trid = objeto.parentNode.parentNode.id.replace("campofiltrosiddest", "");
        filtros[filtros.indexOf(trid)] += "&" + seletor.innerText + "&" + inputvalor.innerText;
        montaConsulta();
    }


    function montaConsulta() {
        var texto = 'SELECT ';

        var dados = $('#camposselecionados tbody tr');

        for (index = 0; index < dados.length; ++index) {
            texto += dados[index].children[1].textContent;
            if (index < (dados.length - 1))
                texto += ', ';
        }

        texto += ' FROM ';

        dados = $('#tabelasselecionadas li');

        for (index = 0; index < dados.length; ++index) {
            texto += dados[index].textContent;
            if (index < (dados.length - 1))
                texto += ', ';
        }

        texto += ' WHERE 1=1 ';

        dados = $('#listaRelacionamento li');

        for (index = 0; index < dados.length; ++index) {
            texto += ' AND ' + dados[index].textContent;
        }



        dados = $('#camposselecionados_filtro tbody tr');

        for (index = 0; index < dados.length; ++index) {
            texto += ' AND ' + dados[index].children[0].textContent + dados[index].children[1].textContent + dados[index].children[2].textContent;
        }


        dados = $('#camposselecionados_posicao tbody tr');

        for (index = 0; index < dados.length; ++index) {
            if (index = 0)
                texto = ' ORDER BY ';
            texto += dados[index].children[1].textContent;
            if (index < (dados.length - 1))
                texto += ', ';
        }


        $('#text_sql').html(texto);
    }

    function montaGroupBy() {
        var dados = $('#camposselecionados tbody').html();
        dados.replace(/campoid/g, "campogruposid");
        $("#camposselecionados_grupo tbody").html(dados);
    }

    function limpaCampos() {
        $("#camposdisponiveis tbody").html('');
        $("#camposdisponiveis_funcoes tbody").html('');
        $("#camposdisponiveis_grupo tbody").html('');
        $("#camposdisponiveis_filtro tbody").html('');
        $("#camposdisponiveis_calculo tbody").html('');
        $("#camposdisponiveis_posicao tbody").html('');

        $("#camposselecionados tbody").html('');
        $("#camposselecionados_funcoes tbody").html('');
        $("#camposselecionados_grupo tbody").html('');
        $("#camposselecionados_filtro tbody").html('');
        $("#camposselecionados_calculo tbody").html('');
        $("#camposselecionados_posicao tbody").html('');

        $('#listaRelacionamento').html('');

        campos = [];
        funcoes = [];
        filtros = [];
        posicoes = [];

    }

    function checaCamposSelecionados() {
        for (index = campos.length - 1; index >= 0; --index) {
            if ($("#camposdisponiveis tbody").html().search(campos[index]) == -1) {
                var tr = $("#campoiddest" + campos[index]);
                tr.fadeOut(400, function () {
                    tr.remove();
                });
                campos.splice(index, 1);
            }
        }

        for (index = funcoes.length - 1; index >= 0; --index) {
            if ($("#camposdisponiveis_funcoes tbody").html().search(funcoes[index]) == -1) {
                var tr = $("#campofuncoesiddest" + funcoes[index]);
                tr.fadeOut(400, function () {
                    tr.remove();
                });
                funcoes.splice(index, 1);
            }
        }

        for (index = filtros.length - 1; index >= 0; --index) {
            if ($("#camposdisponiveis_filtro tbody").html().search(filtros[index]) == -1) {
                var tr = $("#campofiltrosiddest" + filtros[index]);
                tr.fadeOut(400, function () {
                    tr.remove();
                });
                filtros.splice(index, 1);
            }
        }

        for (index = posicoes.length - 1; index >= 0; --index) {
            if ($("#camposdisponiveis_posicao tbody").html().search(posicoes[index]) == -1) {
                var tr = $("#campoposicaoiddest" + posicoes[index]);
                tr.fadeOut(400, function () {
                    tr.remove();
                });
                posicoes.splice(index, 1);
            }
        }

    }



    $(document).ready(function () {

        tabelas = [];
        campos = [];
        funcoes = [];
        filtros = [];
        posicoes = [];

        condicoes = [];
        groupby = [];
        orderby = [];

        $(document).on("click", "#tabelasdisponiveis tbody tr td button", function (event) {
            event.preventDefault();

            var ok = 0;
            var theid = $(this).attr('id').replace("tabelaid", "");

            var novastabelas = new Array();

            for (index = 0; index < tabelas.length; ++index) {

                if (tabelas[index] == theid) {

                    $(this).css("color", "#0c8c12");
                    $(this).html("<span class='glyphicon glyphicon-plus' aria-hidden='true'></span>");

                    var tr = $("#tabelaiddest" + theid);
                    tr.css("background-color", "#FF3700");
                    tr.fadeOut(400, function () {
                        tr.remove();
                    });

                    ok = 1;
                }
                else {
                    novastabelas.push(tabelas[index]);
                }
            }

            tabelas = novastabelas;

            if (!ok) {

                tabelas.push(theid);

                $(this).css("color", "#dd1c1c");
                $(this).html("<span class='glyphicon glyphicon-minus' aria-hidden='true'></span>");

                $('#tabelasselecionadas').append('<li id="tabelaiddest' +
                    theid +
                    '">' +
                    $(this.parentElement.parentElement).find("td").eq(0).html() +
                    '</li>');

            }

            getCampos();
            montaConsulta();

        });


        $(document).on("click",
            "#camposdisponiveis tbody tr td button",
            function (event) {

                event.preventDefault();
                var ok = 0;
                var theid = $(this).attr('id').replace("campoid", "");

                var novoscampos = new Array();

                for (index = 0; index < campos.length; ++index) {

                    if (campos[index] == theid) {

                        $(this).css("color", "#0c8c12");
                        $(this).html("<span class='glyphicon glyphicon-plus' aria-hidden='true'></span>");

                        var tr = $("#campoiddest" + theid);
                        tr.css("background-color", "#FF3700");
                        tr.fadeOut(400, function () {
                            tr.remove();
                        });

                        ok = 1;
                    }
                    else {
                        novoscampos.push(campos[index]);
                    }
                }

                campos = novoscampos;

                if (!ok) {

                    campos.push(theid);

                    $(this).css("color", "#dd1c1c");
                    $(this).html("<span class='glyphicon glyphicon-minus' aria-hidden='true'></span>");

                    $('#camposselecionados').append('<tr id="campoiddest' + theid + '">'
                        + '<td>' + $(this.parentElement.parentElement).find("td").eq(0).html() + '</td>'
                        + '<td>' + $(this.parentElement.parentElement).find("td").eq(1).html() + '</td>'
                        + '<td>' + $(this.parentElement.parentElement).find("td").eq(2).html() + '</td>'
                        + '</tr>');

                }

                montaConsulta();

            });

        $(document).on("click", "#camposdisponiveis_funcoes tbody tr td button", function (event) {

            event.preventDefault();
            var ok = 0;
            var theid = $(this).attr('id').replace("campofuncoesid", "");

            var novasfuncoes = new Array();

            for (index = 0; index < funcoes.length; ++index) {

                if (funcoes[index] == theid) {

                    $(this).css("color", "#0c8c12");
                    $(this).html("<span class='glyphicon glyphicon-plus' aria-hidden='true'></span>");

                    var tr = $("#campofuncoesiddest" + theid);
                    tr.css("background-color", "#FF3700");
                    tr.fadeOut(400, function () {
                        tr.remove();
                    });

                    ok = 1;
                }
                else {
                    novasfuncoes.push(funcoes[index]);
                }
            }

            funcoes = novasfuncoes;

            if (!ok) {

                funcoes.push(theid);

                $(this).css("color", "#dd1c1c");
                $(this).html("<span class='glyphicon glyphicon-minus' aria-hidden='true'></span>");

                $('#camposselecionados_funcoes').append('<tr id="campofuncoesiddest' + theid + '">'
                    + '<td>' + $(this.parentElement.parentElement).find("td").eq(0).html() + '</td>'
                    + '<td>' + $(this.parentElement.parentElement).find("td").eq(1).html() + '</td>'
                    + '<td>' + $(this.parentElement.parentElement).find("td").eq(2).html() + '</td>'
                    + '<td>  <select name="filter_for" onchange="getFuncao(this)" > '
                    + '<option value = "Escolha">--Escolha a opção--</option> '
                    + '<option value = "Média">Média</option> '
                    + '<option value = "Contar">Contar</option>'
                    + '<option value = "Máximo">Máximo</option>'
                    + '<option value = "Mínimo">Mínimo</option>'
                    + '<option value = "Soma">Soma</option>'
                    + '</select ></td>'
                    + '</tr>');
            }

            montaGroupBy();

        });

        $(document).on("click", "#camposdisponiveis_filtro tbody tr td button", function (event) {

            event.preventDefault();
            var ok = 0;
            var theid = $(this).attr('id').replace("campofiltrosid", "");

            var novasfiltros = new Array();

            for (index = 0; index < filtros.length; ++index) {

                if (filtros[index] == theid) {

                    $(this).css("color", "#0c8c12");
                    $(this).html("<span class='glyphicon glyphicon-plus' aria-hidden='true'></span>");

                    var tr = $("#campofiltrosiddest" + theid);
                    tr.css("background-color", "#FF3700");
                    tr.fadeOut(400, function () {
                        tr.remove();
                    });

                    ok = 1;
                }
                else {
                    novasfiltros.push(filtros[index]);
                }
            }

            filtros = novasfiltros;

            if (!ok) {

                filtros.push(theid);

                $(this).css("color", "#dd1c1c");
                $(this).html("<span class='glyphicon glyphicon-minus' aria-hidden='true'></span>");

                var trid = filtros.length.toString();

                $('#camposselecionados_filtro').append('<tr id="campofiltrosiddest' + theid + '">'
                    + '<td>' + $(this.parentElement.parentElement).find("td").eq(1).html() + '</td>'
                    + '<td>  <select id="select_operador_' + trid + '" class="form-control"> '
                    + '<option value = "Escolha" disabled="true" selected>--Escolha a opção--</option> '
                    + '<option value = "=">=</option> '
                    + '<option value = "<>"><></option> '
                    + '<option value = "<"><</option> '
                    + '<option value = "<="><=</option> '
                    + '<option value = ">">></option> '
                    + '<option value = ">=">>=</option> '
                    + '<option value = "Contém">Contém</option> '
                    + '<option value = "Não Contém">Não Contém</option> '
                    + '<option value = "Entre">Entre</option> '
                    + '<option value = "Não está Entre">Não está Entre</option> '
                    + '<option value = "Na Lista">Na Lista</option> '
                    + '<option value = "Não está na Lista">Não está na Lista</option> '
                    + '<option value = "Vazio">Vazio</option> '
                    + '<option value = "Não é Vazio">Não é Vazio</option> '
                    + '</select ></td>'
                    + '<td> <input id="input_valor_' + trid + '" type="text" name="valor" class="form-control">  </td>'
                    + '<td><button type="button" class="btn btn-default" onclick="getFiltro(this,' + trid + ')">Efetiva</button></td>'
                    + '</tr>');
            }

            montaConsulta();

        });

        $(document).on("click", "#camposdisponiveis_calculo tbody tr", function (event) {

        });

        $(document).on("click", "#camposdisponiveis_calculo tbody tr", function (event) {

        });

        $(document).on("click", "#camposdisponiveis_posicao tbody tr td button", function (event) {

            event.preventDefault();
            var ok = 0;
            var theid = $(this).attr('id').replace("campoposicaoid", "");

            var novasposicoes = new Array();

            for (index = 0; index < posicoes.length; ++index) {

                if (posicoes[index] == theid) {

                    $(this).css("color", "#0c8c12");
                    $(this).html("<span class='glyphicon glyphicon-plus' aria-hidden='true'></span>");

                    var tr = $("#campoposicaoiddest" + theid);
                    tr.css("background-color", "#FF3700");
                    tr.fadeOut(400, function () {
                        tr.remove();
                    });

                    ok = 1;
                }
                else {
                    novasposicoes.push(posicoes[index]);
                }
            }

            posicoes = novasposicoes;

            if (!ok) {

                posicoes.push(theid);

                $(this).css("color", "#dd1c1c");
                $(this).html("<span class='glyphicon glyphicon-minus' aria-hidden='true'></span>");

                $('#camposselecionados_posicao').append('<tr id="campoposicaoiddest' + theid + '">'
                    + '<td>' + $(this.parentElement.parentElement).find("td").eq(0).html() + '</td>'
                    + '<td>' + $(this.parentElement.parentElement).find("td").eq(1).html() + '</td>'
                    + '<td>' + $(this.parentElement.parentElement).find("td").eq(2).html() + '</td>'
                    + '</tr>');
            }

            montaConsulta();

        });


        getTabelas();
        getPastas();


    });


    //$("#jqGrid").jqGrid({
    //    url: 'data.json',
    //    mtype: "GET",
    //    datatype: "json",
    //    page: 1,
    //    colModel: [
    //        {
    //            label: "Order ID",
    //            //sorttype: 'integer',
    //            name: 'OrderID',
    //            key: true,
    //            width: 75
    //        },
    //        {
    //            label: "Customer ID",
    //            name: 'CustomerID',
    //            width: 150,
    //            // stype defines the search type control - in this case HTML select (dropdownlist)
    //            stype: "select",
    //            // searchoptions value - name values pairs for the dropdown - they will appear as options
    //            searchoptions: { value: ":[All];ALFKI:ALFKI;ANATR:ANATR;ANTON:ANTON;AROUT:AROUT;BERGS:BERGS;BLAUS:BLAUS;BLONP:BLONP;BOLID:BOLID;BONAP:BONAP;BOTTM:BOTTM;BSBEV:BSBEV;CACTU:CACTU;CENTC:CENTC;CHOPS:CHOPS;COMMI:COMMI;CONSH:CONSH;DRACD:DRACD;DUMON:DUMON;EASTC:EASTC;ERNSH:ERNSH;FAMIA:FAMIA;FOLIG:FOLIG;FOLKO:FOLKO;FRANK:FRANK;FRANR:FRANR;FRANS:FRANS;FURIB:FURIB;GALED:GALED;GODOS:GODOS;GOURL:GOURL;GREAL:GREAL;GROSR:GROSR;HANAR:HANAR;HILAA:HILAA;HUNGC:HUNGC;HUNGO:HUNGO;ISLAT:ISLAT;KOENE:KOENE;LACOR:LACOR;LAMAI:LAMAI;LAUGB:LAUGB;LAZYK:LAZYK;LEHMS:LEHMS;LETSS:LETSS;LILAS:LILAS;LINOD:LINOD;LONEP:LONEP;MAGAA:MAGAA;MAISD:MAISD;MEREP:MEREP;MORGK:MORGK;NORTS:NORTS;OCEAN:OCEAN;OLDWO:OLDWO;OTTIK:OTTIK;PERIC:PERIC;PICCO:PICCO;PRINI:PRINI;QUEDE:QUEDE;QUEEN:QUEEN;QUICK:QUICK;RANCH:RANCH;RATTC:RATTC;REGGC:REGGC;RICAR:RICAR;RICSU:RICSU;ROMEY:ROMEY;SANTG:SANTG;SAVEA:SAVEA;SEVES:SEVES;SIMOB:SIMOB;SPECD:SPECD;SPLIR:SPLIR;SUPRD:SUPRD;THEBI:THEBI;THECR:THECR;TOMSP:TOMSP;TORTU:TORTU;TRADH:TRADH;TRAIH:TRAIH;VAFFE:VAFFE;VICTE:VICTE;VINET:VINET;WANDK:WANDK;WARTH:WARTH;WELLI:WELLI;WHITC:WHITC;WILMK:WILMK;WOLZA:WOLZA" }
    //        },
    //        {
    //            label: "Order Date",
    //            name: 'OrderDate',
    //            width: 150,
    //            sorttype: 'date',
    //            formatter: 'date',
    //            srcformat: 'Y-m-d',
    //            newformat: 'n/j/Y',
    //            searchoptions: {
    //                // dataInit is the client-side event that fires upon initializing the toolbar search field for a column
    //                // use it to place a third party control to customize the toolbar
    //                dataInit: function (element) {
    //                    $(element).datepicker({
    //                        autoclose: true,
    //                        format: 'd/m/yyyy',
    //                        orientation: 'bottom'
    //                    });
    //                }
    //            }
    //        },
    //        {
    //            label: "Ship Name",
    //            name: 'ShipName',
    //            width: 150,
    //            searchoptions: {
    //                // dataInit is the client-side event that fires upon initializing the toolbar search field for a column
    //                // use it to place a third party control to customize the toolbar
    //                dataInit: function (element) {
    //                    $(element).attr("autocomplete", "off").typeahead({
    //                        appendTo: "body",
    //                        source: function (query, proxy) {
    //                            $.ajax({
    //                                url: 'http://trirand.com/blog/phpjqgrid/examples/jsonp/autocompletepbs.php?callback=?&acelem=ShipName',
    //                                dataType: "jsonp",
    //                                data: { term: query },
    //                                success: proxy
    //                            });
    //                        }
    //                    });
    //                },
    //                sopt: ['cn']
    //            }
    //        },
    //        {
    //            label: "Freight",
    //            sorttype: 'number',
    //            name: 'Freight', width: 150
    //        },
    //    ],
    //    loadonce: true,
    //    viewrecords: true,
    //    width: 780,
    //    height: 250,
    //    rowNum: 10,
    //    pager: "#jqGridPager"
    //});
    //// activate the toolbar searching
    //$('#jqGrid').jqGrid('filterToolbar');
    //$('#jqGrid').jqGrid('navGrid', "#jqGridPager", {
    //    search: false, // show search button on the toolbar
    //    add: false,
    //    edit: false,
    //    del: false,
    //    refresh: true
    //});


    //$("#jsGrid").jsGrid({
    //    width: "100%",
    //    height: "400px",

    //    inserting: true,
    //    editing: true,
    //    sorting: true,
    //    paging: true,

    //    data: clients,

    //    fields: [
    //        { name: "Name", type: "text", width: 150, validate: "required" },
    //        { name: "Age", type: "number", width: 50 },
    //        { name: "Address", type: "text", width: 200 },
    //        { name: "Country", type: "select", items: countries, valueField: "Id", textField: "Name" },
    //        { name: "Married", type: "checkbox", title: "Is Married", sorting: false },
    //        { type: "control" }
    //    ]
    //});


</script>
